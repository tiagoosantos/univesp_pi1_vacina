<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Verificador de Vacinação</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.4.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
  <div class="container py-5">
    <h1 class="mb-4 text-center">Verificador de Vacinação</h1>

    <!-- Entrada de data de nascimento -->
    <div class="mb-3">
      <label for="birthdate" class="form-label">Data de Nascimento</label>
      <input type="date" id="birthdate" class="form-control" />
    </div>

    <!-- Exibe a fase após seleção de data -->
    <div id="fase-container" class="d-none">
      <p>Fase: <strong id="fase-text"></strong></p>

      <!-- Container para adicionar vacinas -->
      <div id="vacinas-container"></div>

      <button id="add-vacina-btn" class="btn btn-primary me-2">Adicionar Vacina</button>
      <button id="concluir-btn" class="btn btn-success">Concluir</button>

      <!-- Resultado -->
      <div id="resultado" class="mt-4"></div>
    </div>
  </div>

  <!-- Bootstrap JS (opcional para componentes) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.4.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Definição das vacinas por fase
    const calendario = {
      crianca: [
        { nome: 'BCG', doses: 1, periodo: null },
        { nome: 'Hepatite B', doses: 3, periodo: { inicio: 0, fim: 1 } },
        // ... restante das vacinas
      ],
      adolescente: [
        { nome: 'HPV', doses: 2, periodo: { inicio: 9, fim: 14 } },
        // ... restante das vacinas
      ],
      adulto: [
        { nome: 'dT (difteria e tétano)', doses: 'reforço a cada 10 anos', periodo: null },
        // ... restante das vacinas
      ]
    };

    const birthInput = document.getElementById('birthdate');
    const faseContainer = document.getElementById('fase-container');
    const faseText = document.getElementById('fase-text');
    const vacinasContainer = document.getElementById('vacinas-container');
    const addVacinaBtn = document.getElementById('add-vacina-btn');
    const concluirBtn = document.getElementById('concluir-btn');
    const resultadoDiv = document.getElementById('resultado');

    let faseAtual = null;

    birthInput.addEventListener('change', () => {
      const data = new Date(birthInput.value);
      const hoje = new Date();
      const idadeAnos = hoje.getFullYear() - data.getFullYear() - ((hoje.getMonth() < data.getMonth() || (hoje.getMonth() === data.getMonth() && hoje.getDate() < data.getDate())) ? 1 : 0);

      if (idadeAnos <= 10) faseAtual = 'crianca';
      else if (idadeAnos <= 19) faseAtual = 'adolescente';
      else faseAtual = 'adulto';

      faseText.textContent = faseAtual;
      faseContainer.classList.remove('d-none');
      vacinasContainer.innerHTML = '';
      resultadoDiv.innerHTML = '';
    });

    function criarVacinaItem() {
      const row = document.createElement('div');
      row.className = 'row g-3 mb-3';

      // Vacina
      const colVac = document.createElement('div');
      colVac.className = 'col-md-5';
      const select = document.createElement('select');
      select.className = 'form-select';
      const padrao = document.createElement('option');
      padrao.text = 'Selecione a vacina'; padrao.value = '';
      select.add(padrao);
      calendario[faseAtual].forEach(v => {
        const opt = document.createElement('option');
        opt.value = v.nome;
        opt.text = `${v.nome} (${v.doses} dose(s))`;
        select.add(opt);
      });
      colVac.appendChild(select);

      // Dose
      const colDose = document.createElement('div');
      colDose.className = 'col-md-3';
      const doseInput = document.createElement('input');
      doseInput.type = 'number';
      doseInput.min = 1;
      doseInput.placeholder = 'Dose';
      doseInput.className = 'form-control';
      colDose.appendChild(doseInput);

      // Ano
      const colAno = document.createElement('div');
      colAno.className = 'col-md-3';
      const anoInput = document.createElement('input');
      anoInput.type = 'number';
      anoInput.min = 1900;
      anoInput.max = new Date().getFullYear();
      anoInput.placeholder = 'Ano';
      anoInput.className = 'form-control';
      colAno.appendChild(anoInput);

      // Botão remover
      const colRem = document.createElement('div');
      colRem.className = 'col-md-1 d-flex align-items-center';
      const remBtn = document.createElement('button');
      remBtn.type = 'button';
      remBtn.className = 'btn btn-outline-danger btn-sm';
      remBtn.textContent = '✕';
      remBtn.addEventListener('click', () => row.remove());
      colRem.appendChild(remBtn);

      row.append(colVac, colDose, colAno, colRem);
      return row;
    }

    addVacinaBtn.addEventListener('click', () => {
      vacinasContainer.appendChild(criarVacinaItem());
    });

    concluirBtn.addEventListener('click', () => {
      resultadoDiv.innerHTML = '';
      const items = vacinasContainer.querySelectorAll('.row');
      const relatorio = [];

      items.forEach(el => {
        const nome = el.querySelector('select').value;
        const dose = parseInt(el.querySelector('input[type=number]').value);
        const ano = parseInt(el.querySelectorAll('input[type=number]')[1].value);
        if (!nome) return;

        const vacInfo = calendario[faseAtual].find(v => v.nome === nome);
        const status = { nome, dose, ano, situacao: '' };

        if (!vacInfo) {
          status.situacao = '❌ Ignorada (não aplicável)';
        } else if (vacInfo.doses === 'reforço a cada 10 anos' || dose === vacInfo.doses) {
          status.situacao = '✅ OK';
        } else {
          status.situacao = '⚠️ Dose incorreta';
        }

        relatorio.push(status);
      });

      relatorio.forEach(r => {
        const alert = document.createElement('div');
        let cls = 'alert ';
        if (r.situacao.startsWith('✅')) cls += 'alert-success';
        else if (r.situacao.startsWith('⚠️')) cls += 'alert-warning';
        else cls += 'alert-danger';
        alert.className = cls;
        alert.textContent = `${r.nome}: ${r.situacao}`;
        resultadoDiv.appendChild(alert);
      });
    });
  </script>
</body>
</html>
